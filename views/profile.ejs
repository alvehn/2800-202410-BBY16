<%- include("templates/header", { username: user.username }) %>
<!-- <div class="flex flex-col w-full min-h-screen pt-16 pb-16 overflow-y-auto"> Adjusted padding and overflow -->
    
    <div class="bg-celadon w-full p-4 flex flex-col items-center justify-center text-white rounded-b-3xl">
        <div class="flex flex-row justify-between items-center h-1/5 w-full">
            <!-- <div class="text-xl font-semibold">Profile</div> -->
            <a href="/update_profile" class="text-light-coral font-semibold text-lg no-underline hover:underline">Edit</a>
        </div>
        <div class="h-2/5 bg-orange-300 flex items-center justify-center rounded-md mb-2">
            <img src="<%= profileImageUrl %>" alt="Profile Image" class="h-full rounded-full object-cover border-4 border-white">
        </div> 
        <div class="h-3/5 flex flex-col justify-center items-center">
            <h2 class="text-center font-semibold"><%= user.display_name %></h2>
            <h3 class="text-center text-base">#<%= user.username %></h3>
            <h3 class="text-center text-base"><%= user.email %></h3>
        </div>
    </div>

 <div class="flex flex-col w-full h-auto pb-20 overflow-y-auto">
    <div class="h-36 p-4 m-3">
        <div class="w-full h-full flex flex-row justify-evenly rounded-xl">
            <div class="bg-light-blue w-1/3 h-full flex flex-col items-center justify-center rounded-xl m-2 p-4 border-4 border-white">
                <span class="text-5xl">ðŸ¥‡</span>
                <span class="flex items-center justify-center h-full text-xl font-semibold"><%= user.study_streak %> hrs</span>
            </div>
            <div class="bg-light-blue w-1/3 h-full flex flex-col items-center justify-center rounded-xl m-2 p-4 border-4 border-white">
                <span class="text-5xl">ðŸ¥ˆ</span>
                <span class="flex items-center justify-center h-full text-xl font-semibold"><%= Math.floor(user.total_study_hours / 3600) %> hrs</span>
            </div>
            <div class="bg-light-blue w-1/3 h-full flex flex-col items-center justify-center rounded-xl m-2 p-4 border-4 border-white">
                <span class="text-5xl">ðŸ¥‰</span>
                <span class="flex items-center justify-center h-full text-xl font-semibold">GroupsNumber</span>
            </div>
        </div>
    </div>
    
    <div class="h-80 p-7 m-4 rounded-lg border-4 border-white">
        <div class="flex justify-between">
            <div class="text-2xl font-semibold mb-4">Study Calendar</div>
            <div>
                <label for="year-select">Select Year:</label>
                <select id="year-select" class="years"></select>
            </div>
        </div>
        <div class="calendar"></div>
    </div>
 </div>
</div>

<script>
    const user_study_history = JSON.parse('<%- JSON.stringify(user.study_history) %>');
    document.addEventListener('DOMContentLoaded', () => {
        console.log(user_study_history);
        const calendar = document.querySelector('.calendar');
        const yearSelect = document.getElementById('year-select');
        const years = new Set(user_study_history.map(day => day.date.split('-')[0]));

        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = 'All Years';
        yearSelect.appendChild(defaultOption);

        years.forEach(year => {
            const yearOption = document.createElement('option');
            yearOption.value = year;
            yearOption.textContent = year;
            yearSelect.appendChild(yearOption);
        });

        yearSelect.addEventListener('change', () => {
            displayHistory(yearSelect.value);
        });

        function displayHistory(selectedYear) {
            calendar.innerHTML = '';
            user_study_history.forEach(day => {
                const [year, month, date] = day.date.split('-');
                console.log(`Processing date: ${date}`);
                if (selectedYear === '' || year === selectedYear) {
                    const dayBox = document.createElement('div');
                    dayBox.classList.add('day-box');
                    if (day.total_hours <= 7200) { // 2 hours in seconds
                        dayBox.classList.add('low');
                    } else if (day.total_hours <= 14400) { // 4 hours in seconds
                        dayBox.classList.add('medium');
                    } else {
                        dayBox.classList.add('high');
                    }
                    const yearSpan = document.createElement('span');
                    yearSpan.textContent = year;

                    const hoursSpan = document.createElement('span');
                    const hours = (day.total_hours / 3600).toFixed(1);
                    hoursSpan.textContent = `${hours} hrs`;

                    const dateSpan = document.createElement('span');
                    dateSpan.textContent = `${month} - ${date}`; // Extract and format the month and day
                    dateSpan.classList.add('text-xs');

                    dayBox.appendChild(yearSpan);
                    dayBox.appendChild(dateSpan);
                    dayBox.appendChild(hoursSpan);

                    calendar.appendChild(dayBox);
                }
            });
        }
        yearSelect.value = '';
        displayHistory('');
    });
</script>

<%- include("templates/navbar") %>
